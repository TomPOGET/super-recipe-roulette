<!DOCTYPE html>
<html lang="fr">
<head>
  <%- include('partials/header.ejs') %>
  <script src="js/vue.js"></script>
</head>
<body>
  <!-- Navbar -->
  <%- include('partials/navbar.ejs') %>

  <!-- Banner -->
  <div class="banner">
    <h1>Soumettez Votre Recette</h1>
    <p>Partagez vos délicieuses créations culinaires avec notre communauté!</p>
  </div>

  <!-- Recipe Submission Form Container -->
  <div class="submission-container">
    <div class="submission-card">
      <h2>Formulaire de Soumission</h2>
      <form id="recipeForm" action="/submit" method="POST">
        <!-- Recipe Title -->
        <div class="form-group">
          <label for="recipeTitle">Nom de la Recette<span class="required">*</span></label>
          <input type="text" id="recipeTitle" name="name" placeholder="Entrez le titre de la recette" required>
        </div>

        <!-- Ingredients -->
        <div class="form-group" id="ingredients">
          <label for="ingredients">Ingrédients<span class="required">*</span></label>

          <ingredient
          v-for="ingredient in ingredients"
          :key="ingredient.id"
          :numero="ingredient.id"
          @remove="removeIngredientById"
          style="padding-bottom:10px;"
          ></ingredient>
          
          <button type="button" class="add-button" v-on:click="addIngredient()">Ajouter un autre ingrédient</button>
        </div>
            

        <!-- Preparation Steps -->
        <div class="form-group">
          <label for="preparation">Étapes de Préparation<span class="required">*</span></label>
          <textarea id="preparation" name="instructions" rows="6" placeholder="Décrivez les étapes de préparation, un par ligne" required></textarea>
        </div>



        <!-- Category -->
        <div class="form-group">
          <label for="category">Catégorie<span class="required">*</span></label>
          <select id="category" name="category" required>
            <option value="" disabled selected>Choisissez une catégorie</option>
            <option value="ENTREE">Entrées</option>
            <option value="PRINCIPAL">Plats Principaux</option>
            <option value="DESSERT">Desserts</option>
            <option value="BOISSON">Boissons</option>
            <option value="AUTRES">Autres</option>
          </select>
        </div>

        <!-- Image Upload, à gerer après (on va l'enregister dans le server) -->

        
        <!-- <div class="form-group">
          <label for="recipeImage">Image de la Recette<span class="required">*</span></label>
          <input type="file" id="recipeImage" name="recipeImage" accept="image/*" required>
        </div> -->
       

        <!-- Submit Button -->
        <div class="form-group">
          <button type="submit" class="submit-button">Soumettre la Recette</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Pied de Page -->
  <%- include('partials/footer.ejs') %>




  <script>
    // Ingredient Component
    Vue.component("ingredient", {
      template: `
        <div :id="'ingredient' + numero" style="white-space: nowrap;">
          <label :for="'ingredientName' + numero">Nom :</label>
          <input type="text" :id="'ingredientName' + numero" :name="'ingredients[' + numero + '][name]'" placeholder="Fromage" style="width: 170px;" required>

          <label :for="'ingredientQuantity' + numero">Quantité :</label>
          <input type="text" :id="'ingredientQuantity' + numero" :name="'ingredients[' + numero + '][quantity]'" placeholder="100" style="width: 70px;" required>

          <label :for="'ingredientUnit' + numero">Unité :</label>
          <input type="text" :id="'ingredientUnit' + numero" :name="'ingredients[' + numero + '][unit]'" placeholder="ml" style="width: 115px;" required>

          <button class="add-button" @click="$emit('remove', numero)">X</button>
        </div>
      `,
      props: ['numero'],
    });

    // Vue Instance
    const app = new Vue({
      el: "#ingredients",
      data: {
        ingredients: [{ id: 0 }], // Start with one ingredient
        nextIngredientId: 1,
      },
      methods: {
        addIngredient() {
          this.ingredients.push({ id: this.nextIngredientId++ });
        },
        removeIngredientById(id) {
          if (this.ingredients.length > 1) {
            this.ingredients = this.ingredients.filter(ingredient => ingredient.id !== id);
          }
        }
      },
    });
  </script>
  <script>
    //Vérification Champs
    document.getElementById('recipeForm').addEventListener('submit', function(event) {
      const quantityInputs = document.querySelectorAll('input[name*="[quantity]"]');
      for (let input of quantityInputs) {
        const value = input.value.trim();
        if (value === '' || isNaN(value) || Number(value) <= 0) {
          alert('Veuillez entrer des quantités valides (nombres positifs) pour tous les ingrédients.');
          event.preventDefault(); // Empêcher la soumission du formulaire
          return;
        }
      }
    });
  </script>
</body>
</html>