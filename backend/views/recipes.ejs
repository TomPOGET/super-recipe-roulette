<!DOCTYPE html>
<html lang="fr">
<head>
  <%- include('partials/header.ejs') %>
  <script src="js/jquery.min.js"></script>
</head>
<body>
  <!-- Navbar -->
  <%- include('partials/navbar.ejs') %>

  <!-- Banner -->
  <div class="banner">
    <h1>Recherchez Vos Recettes Préférées</h1>
    <p>Trouvez la recette parfaite en un clin d'œil!</p>
  </div>

  <% if(specificRecipe){ %>

    <div class="recipe-of-the-day">
  
      <img src="img/recipes/<%=recipe.recipeId%>.png" alt="Salade de Quinoa">
      <div class="recipe-details">
        <h2><%= recipe.name %></h2>

        <div class="category">
          <h3>Category</h3>
          <ul>
            <li><%= recipe.category %></li>
          </ul>
        </div>
        <div class="ingredients">
          <h3>Ingrédients :</h3>

        
          <ul>

              <% for(ingredient of ingredients){ %>
                <li><%= ingredient.quantity %> <%=ingredient.unit%> de <%=ingredient.ingredient%></li>
              <% } %>
          </ul>
        </div>
        <div class="preparation">
          <h3>Préparation :</h3>
          <%= recipe.instructions %>
        </div>
      </div>
    </div>

  <% }else{ %>
  <!-- Page de Recherche -->
  <div class="search-page">
    <!-- Barre de Recherche -->
    <%- include('partials/search.ejs') %>

    <h2>Choissez votre recette</h2>
    <!-- Résultats de la Recherche -->
    <div class="results-container">

      <% for (const recipe of recipes) { %> 
      <div class="recipe-card">
        <img src="img/recipes/<%= recipe.recipeId %>.png" alt="Recipe Image">
        <h3><a href="/recipes?recipe=<%= recipe.recipeId %>" class="recipe-link"><%= recipe['name'] %></a></h3>
      </div>
    <% } %>
    </div>
  </div>



  <% } %>
<!-- Pied de Page -->
<%- include('partials/footer.ejs') %>

<script>
  $(document).ready(function () {
    // Empêcher la soumission du formulaire par défaut (pour gérer "Entrée")
    $("#search-form").on("submit", function (event) {
        event.preventDefault(); // Bloque le comportement par défaut de "submit"
    });

    // Gérer la recherche dynamique à chaque frappe
    $("#search").on("keyup", function () {
        const query = $(this).val().trim(); // Récupère la valeur de la recherche
        if (query === "") {
            // Si le champ est vide, afficher toutes les recettes
            $.get("/recipes/all", function (response) {
                $(".results-container").html(response); // Afficher toutes les recettes
            }).fail(function () {
                $(".results-container").html("<p>Erreur lors du chargement des recettes.</p>");
            });
        } else {
            // Si un texte est saisi, effectuer une recherche
            $.get("/recipes/search", { query: query }, function (response) {
                $(".results-container").html(response); // Afficher les résultats
            }).fail(function () {
                $(".results-container").html("<p>Erreur lors de la recherche.</p>");
            });
        }
    });
  });
</script>

  
</body>
</html>