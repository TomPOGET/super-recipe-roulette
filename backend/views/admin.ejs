<!DOCTYPE html>
<html lang="fr">
<head>
  <%- include('partials/header.ejs') %>
  <!-- Styles personnalisés pour le tableau de bord admin -->
  <link rel="stylesheet" href="/css/admin.css">
  <script src="js/jquery.min.js"></script>
</head>
<body>
  <!-- Navbar -->
  <%- include('partials/navbar.ejs') %>

  <!-- Conteneur du Tableau de Bord Administrateur -->
  <div class="admin-dashboard">
    <h1>Tableau de Bord Administrateur</h1>

    <!-- Onglets de Navigation -->
    <div class="admin-tabs">
      <button class="tab-button active" onclick="openTab(event, 'pending')">Recettes en Attente</button>
      <button class="tab-button" onclick="openTab(event, 'manage')">Gérer les Recettes</button>
    </div>

    <!-- Onglet des Recettes en Attente -->
    <div id="pending" class="tab-content active">
      <h2>Recettes en Attente de Validation</h2>
      <div class="recipe-list">
        
        <% for (recipe of invalidRecipes){ %>

          <div class="recipe-card">
            <img src="img/recipes/<%=recipe.recipeId%>.png" alt="Salade de Quinoa">
            <h3><a href="recipes?recipe=<%= recipe.recipeId %>"><%= recipe.name %></a></h3>
            <p><%= recipe.instructions%></p>
            <div class="admin-actions">
              <button class="approve-button" data-id="<%= recipe.recipeId %>">Approuver</button>
              <button class="reject-button" data-id="<%= recipe.recipeId %>">Rejeter</button>

            </div>
          </div>

      <% } %>
        
        
      </div>
    </div>

    <!-- Onglet Gérer les Recettes -->
    <div id="manage" class="tab-content">
      <h2>Gérer les Recettes Existantes</h2>
      <div class="recipe-list">
        
        
        <% for (recipe of validRecipes){ %>

          <div class="recipe-card">
            <img src="img/recipes/<%=recipe.recipeId%>.png" alt="Salade de Quinoa">
            <h3><a href="recipes?recipe=<%= recipe.recipeId %>"><%= recipe.name %></a></h3>
            <p><%= recipe.instructions%></p>
            <div class="admin-actions">
              <button class="edit-button">Modifier</button>
              <button class="delete-button" data-id="<%= recipe.recipeId %>">Supprimer</button>
            </div>
          </div>

      <% } %>


      </div>
    </div>
  </div>
    
  <!-- Pied de Page -->
  <%- include('partials/footer.ejs') %>

  <!-- JavaScript pour les Onglets -->
  <script>

$(document).ready(function () {
    //approuver une recette
    $(".approve-button").click(function () {
        // Récupérer l'élément parent du bouton (par exemple, la carte de recette)
        const recipeCard = $(this).closest(".recipe-card");

        // Récupérer la valeur de data-id
        const recipeId = $(this).data("id");

        // Envoyer une requête POST avec l'ID
        $.post("/recipes", { approve: recipeId }, function (response) {
            // Si la requête réussit, faire une animation pour supprimer le div
            recipeCard.fadeOut(500, function () {
                $(this).remove(); // Supprimer le div du DOM après l'animation
            });
        }).fail(function (xhr) {
            alert("Erreur lors de l'approbation : " + xhr.responseText);
        });
    });



    // Gestion du rejet des recettes
    $(".recipe-list").on("click", ".reject-button", function () {
        // Récupérer l'élément parent (la carte de recette)
        const recipeCard = $(this).closest(".recipe-card");

        // Récupérer l'ID de la recette depuis l'attribut data-id
        const recipeId = $(this).data("id");

        // Envoyer une requête POST pour rejeter la recette
        $.post("/recipes/reject", { id: recipeId }, function (response) {
            // Si la requête réussit, faire une animation pour supprimer le div
            recipeCard.fadeOut(500, function () {
                $(this).remove(); // Supprimer le div du DOM après l'animation
            });
        }).fail(function (xhr) {
            alert("Erreur lors du rejet : " + xhr.responseText);
        });
    });


    

   
    // Gestion de la suppression des recettes
    $(".recipe-list").on("click", ".delete-button", function () {
        // Récupérer l'élément parent (la carte de recette)
        const recipeCard = $(this).closest(".recipe-card");

        // Récupérer l'ID de la recette depuis l'attribut data-id
        const recipeId = $(this).data("id");

        // Envoyer une requête POST pour supprimer la recette
        $.post("/recipes/delete", { id: recipeId }, function (response) {
            // Si la requête réussit, faire une animation pour supprimer le div
            recipeCard.fadeOut(500, function () {
                $(this).remove(); // Supprimer le div du DOM après l'animation
            });
        }).fail(function (xhr) {
            alert("Erreur lors de la suppression : " + xhr.responseText);
        });
    });



});





function openTab(evt, tabName) {
      var i, tabcontent, tabbuttons;
      tabcontent = document.getElementsByClassName("tab-content");
      for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].classList.remove('active');
      }
      tabbuttons = document.getElementsByClassName("tab-button");
      for (i = 0; i < tabbuttons.length; i++) {
        tabbuttons[i].classList.remove('active');
      }
      document.getElementById(tabName).classList.add('active');
      evt.currentTarget.classList.add('active');
    }


  

  </script>
</body>
</html>
